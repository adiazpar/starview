/* ExploreMap Styles
 * Map container and bottom card (Airbnb-style).
 */

.explore-map {
  position: relative;
  width: 100%;
  height: 100%;
}

.explore-map__container {
  width: 100%;
  height: 100%;
  /* Transparent to show starfield behind */
  background: transparent;
  /* Glass-style border following design system */
  border: 1px solid var(--glass-border);
  border-radius: calc(var(--radius) * 2);
  overflow: hidden;
  /* Start invisible, fade in when loaded */
  opacity: 0;
  transition: opacity 0.4s ease-out;
}

/* Make Mapbox canvas transparent so starfield shows through */
.explore-map__container .mapboxgl-canvas {
  background: transparent !important;
}

/* Hide geolocate button (we auto-trigger it, only show the user marker) */
.explore-map__container .mapboxgl-ctrl-geolocate {
  display: none;
}

.explore-map__container--loaded {
  opacity: 1;
}

/* Remove border and radius on mobile */
@media (max-width: 768px) {
  .explore-map__container {
    border: none;
    border-radius: 0;
  }
}

/* Error State */
.explore-map--error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-md);
  color: var(--text-muted);
}

.explore-map--error i {
  font-size: 48px;
  color: var(--error);
  opacity: 0.7;
}

/* ========================================
   Bottom Card (matches LocationCard styling)
   ======================================== */

/* Card dimension variables - used by JS for flyTo offset calculation */
.explore-map {
  --card-margin: var(--space-md);
  --card-aspect-ratio: calc(7 / 16);
  --card-content-height: 80px;
}

.explore-map__card {
  position: absolute;
  bottom: var(--card-margin);
  left: var(--card-margin);
  right: var(--card-margin);
  background: var(--bg-base);
  border-radius: calc(var(--radius) * 2);
  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
  overflow: hidden;
  cursor: pointer;
  z-index: calc(var(--z-navbar) - 1); /* Above toggle button (28), below navbar (30) */

  /* Slide-up animation */
  transform: translateY(calc(100% + var(--space-md)));
  opacity: 0;
  transition: transform 0.3s ease-out, opacity 0.3s ease-out;
}

.explore-map__card--visible {
  transform: translateY(0);
  opacity: 1;
}

/* Fade animation for switching between markers */
.explore-map__card--switching {
  transition: opacity 0.15s ease-out;
  transform: translateY(0);
}

/* Card Loading State */
.explore-map__card-loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-xl);
  color: var(--accent);
  font-size: var(--text-xl);
}

/* Card Image Container */
.explore-map__card-image-container {
  position: relative;
  width: 100%;
  /* Inverse of --card-aspect-ratio (7/16) since CSS aspect-ratio is width/height */
  aspect-ratio: 16 / 7;
  overflow: hidden;
}

.explore-map__card-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Card Button - shared base styles for all card buttons */
.explore-map__card-btn {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  background: var(--navbar-bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-full);
  color: var(--text-secondary);
  font-size: var(--text-base);
  cursor: pointer;
  text-decoration: none;
  transition: color 0.15s ease, border-color 0.15s ease;
}

.explore-map__card-btn:hover {
  color: var(--text-primary);
  border-color: var(--text-muted);
}

/* Close button - top right */
.explore-map__card-btn--close {
  position: absolute;
  top: var(--space-sm);
  right: var(--space-sm);
  z-index: 3;
}

/* Favorite button - top right, next to close */
.explore-map__card-btn--favorite {
  position: absolute;
  top: var(--space-sm);
  right: calc(var(--space-sm) + 40px + var(--space-xs));
  z-index: 3;
}

.explore-map__card-btn--favorite.active {
  color: #ef4444;
  border-color: #ef4444;
}

.explore-map__card-btn--favorite.active:hover {
  color: #dc2626;
  border-color: #dc2626;
}

/* Observatory action buttons container - top left */
.explore-map__card-actions {
  position: absolute;
  top: var(--space-sm);
  left: var(--space-sm);
  display: flex;
  gap: var(--space-xs);
  z-index: 3;
}

/* Card Content - matches LocationCard */
.explore-map__card-content {
  padding: var(--space-md);
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
}

.explore-map__card-header {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.explore-map__card-name {
  font-family: var(--font-display);
  font-size: var(--text-base);
  font-weight: 600;
  color: var(--text-primary);
  margin: 0;
  line-height: 1.3;
}

.explore-map__card-region {
  font-size: var(--text-sm);
  color: var(--text-muted);
}

/* Card Meta - matches LocationCard */
.explore-map__card-meta {
  display: flex;
  align-items: center;
  gap: var(--space-md);
  flex-wrap: wrap;
}

.explore-map__card-meta > div {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: var(--text-xs);
  color: var(--text-secondary);
  line-height: 1;
}

.explore-map__card-meta i {
  font-size: var(--text-xs);
  width: 12px;
  text-align: center;
}

.explore-map__card-meta span {
  font-size: var(--text-xs);
}

/* Rating */
.explore-map__card-rating i {
  color: #fbbf24;
}

.explore-map__card-reviews {
  color: var(--text-muted);
}

.explore-map__card-rating--empty {
  color: var(--text-muted);
}

.explore-map__card-rating--empty i {
  color: var(--text-muted);
}

/* Elevation */
.explore-map__card-elevation i {
  color: #f87171; /* light red */
}

/* Distance */
.explore-map__card-distance i {
  color: var(--info);
}

/* ========================================
   Map Controls (Zones, Style Picker)
   ======================================== */

.explore-map__controls {
  position: absolute;
  top: var(--space-md);
  right: var(--space-md);
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  z-index: 10;
}

/* Left-side controls (navigation button) */
.explore-map__controls--left {
  right: auto;
  left: var(--space-md);
}

.explore-map__control {
  position: relative;
  /* Start hidden, animate in when map loads */
  opacity: 0;
  transform: translateX(10px);
}

/* Staggered fade-in animation for each control */
.explore-map__controls--loaded .explore-map__control {
  animation: controlFadeIn 0.3s ease-out forwards;
  /* Default delay, overridden by inline style */
  animation-delay: var(--stagger-delay, 0.3s);
}

/* Left controls animate from left */
.explore-map__controls--left .explore-map__control {
  transform: translateX(-10px);
  /* Don't establish positioning context - let dropdown position relative to map container */
  position: static;
}

.explore-map__controls--left.explore-map__controls--loaded .explore-map__control {
  animation: controlFadeInLeft 0.3s ease-out forwards;
  animation-delay: var(--stagger-delay, 0.3s);
}

@keyframes controlFadeIn {
  from {
    opacity: 0;
    transform: translateX(10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes controlFadeInLeft {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Circular icon-only buttons using navbar color */
.explore-map__control-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  padding: 0;
  background: var(--navbar-bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-full);
  color: var(--text-secondary);
  font-size: var(--text-base);
  cursor: pointer;
  transition: all var(--transition) ease;
}

.explore-map__control-btn:hover {
  color: var(--text-primary);
  border-color: var(--text-muted);
}

.explore-map__control-btn--active {
  color: var(--accent);
  border-color: var(--accent);
}

.explore-map__control-btn--active:hover {
  color: var(--accent-hover);
  border-color: var(--accent-hover);
}

/* Dropdown positioned to the left of buttons */
.explore-map__dropdown {
  --dropdown-animation-duration: 0.1s;

  position: absolute;
  top: 0;
  right: calc(100% + var(--space-sm));
  min-width: 200px;
  padding: var(--space-sm);
  background: var(--bg-base);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  /* Fade animation */
  animation: dropdownFadeIn var(--dropdown-animation-duration) ease-out forwards;
}

/* Dropdown positioned to the right of buttons (for left-side controls) */
.explore-map__dropdown--right {
  right: auto;
  left: calc(100% + var(--space-sm));
}

@keyframes dropdownFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.explore-map__dropdown--closing {
  animation: dropdownFadeOut var(--dropdown-animation-duration) ease-out forwards;
}

@keyframes dropdownFadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

.explore-map__dropdown-option {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  border-radius: calc(var(--radius) / 2);
  cursor: pointer;
  transition: background var(--transition) ease;
  background: transparent;
  border: none;
  width: 100%;
  text-align: left;
  color: var(--text-primary);
}

.explore-map__dropdown-option:hover {
  background: var(--accent-bg);
}

/* Custom checkbox styling matching form-checkbox */
.explore-map__dropdown-option input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 16px;
  height: 16px;
  background: var(--glass-bg-hover);
  border: 1px solid var(--glass-border-hover);
  border-radius: 4px;
  cursor: pointer;
  position: relative;
  transition: background-color 0.2s ease, border-color 0.2s ease;
  flex-shrink: 0;
}

.explore-map__dropdown-option input[type="checkbox"]:hover {
  border-color: var(--accent);
}

.explore-map__dropdown-option input[type="checkbox"]:checked {
  background: var(--accent);
  border-color: var(--accent);
}

.explore-map__dropdown-option input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 5px;
  width: 4px;
  height: 8px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

/* Custom radio button styling matching checkbox */
.explore-map__dropdown-option input[type="radio"] {
  appearance: none;
  -webkit-appearance: none;
  width: 16px;
  height: 16px;
  background: var(--glass-bg-hover);
  border: 1px solid var(--glass-border-hover);
  border-radius: var(--radius-full);
  cursor: pointer;
  position: relative;
  transition: background-color 0.2s ease, border-color 0.2s ease;
  flex-shrink: 0;
}

.explore-map__dropdown-option input[type="radio"]:hover {
  border-color: var(--accent);
}

.explore-map__dropdown-option input[type="radio"]:checked {
  background: var(--accent);
  border-color: var(--accent);
}

.explore-map__dropdown-option input[type="radio"]:checked::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 6px;
  height: 6px;
  background: white;
  border-radius: var(--radius-full);
  transform: translate(-50%, -50%);
}

/* IUCN color swatch */
.explore-map__iucn-color {
  width: 12px;
  height: 12px;
  border-radius: 2px;
  flex-shrink: 0;
}

.explore-map__dropdown-label {
  font-size: var(--text-sm);
  color: var(--text-primary);
  white-space: nowrap;
}

.explore-map__dropdown-hint {
  font-size: var(--text-xs);
  color: var(--text-muted);
  padding: var(--space-xs) var(--space-sm);
  border-bottom: 1px solid var(--border-subtle);
  margin-bottom: var(--space-xs);
}

/* "All" toggle option with separator */
.explore-map__dropdown-option--all {
  border-bottom: 1px solid var(--border-subtle);
  margin-bottom: var(--space-xs);
  padding-bottom: var(--space-sm);
}

.explore-map__dropdown-option--all .explore-map__dropdown-label {
  font-weight: 500;
}


/* ========================================
   Protected Area Popup
   ======================================== */

/* Mapbox popup container override - use !important to override Mapbox defaults immediately */
.protected-area-popup-container.mapboxgl-popup .mapboxgl-popup-content {
  background: var(--bg-base) !important;
  border: none !important;
  border-radius: var(--radius) !important;
  padding: 0 !important;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4) !important;
}

/* Style the popup tip (arrow) to match background - anchor-specific to preserve triangle shape */
.protected-area-popup-container.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
  border-top-color: var(--bg-base) !important;
}

.protected-area-popup-container.mapboxgl-popup-anchor-top .mapboxgl-popup-tip {
  border-bottom-color: var(--bg-base) !important;
}

.protected-area-popup-container.mapboxgl-popup-anchor-left .mapboxgl-popup-tip {
  border-right-color: var(--bg-base) !important;
}

.protected-area-popup-container.mapboxgl-popup-anchor-right .mapboxgl-popup-tip {
  border-left-color: var(--bg-base) !important;
}

/* Corner anchors: square off the corner where tip connects */
.protected-area-popup-container.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip {
  border-bottom-color: var(--bg-base) !important;
}
.protected-area-popup-container.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content {
  border-top-left-radius: 0 !important;
}

.protected-area-popup-container.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip {
  border-bottom-color: var(--bg-base) !important;
}
.protected-area-popup-container.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content {
  border-top-right-radius: 0 !important;
}

.protected-area-popup-container.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip {
  border-top-color: var(--bg-base) !important;
}
.protected-area-popup-container.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content {
  border-bottom-left-radius: 0 !important;
}

.protected-area-popup-container.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {
  border-top-color: var(--bg-base) !important;
}
.protected-area-popup-container.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content {
  border-bottom-right-radius: 0 !important;
}

/* Popup inner content */
.protected-area-popup {
  padding: var(--space-sm) var(--space-md);
  min-width: 200px;
  max-width: 280px;
}

.protected-area-popup__header {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-xs);
}

.protected-area-popup__color {
  width: 10px;
  height: 10px;
  border-radius: 2px;
  flex-shrink: 0;
}

.protected-area-popup__name {
  font-family: var(--font-display);
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--text-primary);
  line-height: 1.3;
}

.protected-area-popup__designation {
  font-size: var(--text-xs);
  color: var(--text-muted);
  margin-bottom: var(--space-sm);
  padding-left: calc(10px + var(--space-sm)); /* Align with name */
}

.protected-area-popup__details {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  border-top: 1px solid var(--border-subtle);
  padding-top: var(--space-sm);
}

.protected-area-popup__row {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: var(--space-md);
}

.protected-area-popup__label {
  font-size: var(--text-xs);
  color: var(--text-muted);
  white-space: nowrap;
}

.protected-area-popup__value {
  font-size: var(--text-xs);
  color: var(--text-secondary);
  text-align: right;
}

/* ========================================
   Location Marker Popup
   ======================================== */

/* Mapbox popup container override */
.marker-popup-container.mapboxgl-popup .mapboxgl-popup-content {
  background: var(--bg-base) !important;
  border: none !important;
  border-radius: var(--radius) !important;
  padding: 0 !important;
  box-shadow: var(--shadow) !important;
}

/* Style the popup tip - anchor-specific */
.marker-popup-container.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
  border-top-color: var(--bg-base) !important;
}

.marker-popup-container.mapboxgl-popup-anchor-top .mapboxgl-popup-tip {
  border-bottom-color: var(--bg-base) !important;
}

.marker-popup-container.mapboxgl-popup-anchor-left .mapboxgl-popup-tip {
  border-right-color: var(--bg-base) !important;
}

.marker-popup-container.mapboxgl-popup-anchor-right .mapboxgl-popup-tip {
  border-left-color: var(--bg-base) !important;
}

/* Hide tip for corner anchors */
.marker-popup-container.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip,
.marker-popup-container.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip,
.marker-popup-container.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip,
.marker-popup-container.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {
  display: none !important;
}

/* Popup inner content */
.marker-popup {
  padding: var(--space-sm) var(--space-md);
  min-width: 140px;
}

.marker-popup__type {
  font-size: 10px;
  font-weight: 500;
  color: var(--accent);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 2px;
}

.marker-popup__name {
  font-family: var(--font-display);
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--text-primary);
  line-height: 1.3;
  margin-bottom: 2px;
}

.marker-popup__region {
  font-size: var(--text-xs);
  color: var(--text-muted);
  margin-bottom: var(--space-xs);
}

.marker-popup__meta {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.marker-popup__rating {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: var(--text-xs);
  color: var(--text-secondary);
}

.marker-popup__rating i {
  color: #fbbf24;
  font-size: 10px;
}

.marker-popup__rating--empty {
  color: var(--text-muted);
}

.marker-popup__reviews {
  color: var(--text-muted);
}

.marker-popup__no-rating {
  font-style: italic;
  color: var(--text-muted);
}

.marker-popup__favorite {
  color: #ec4899;
  font-size: var(--text-xs);
}


/* ========================================
   Cluster Popup
   ======================================== */

.cluster-popup-container.mapboxgl-popup .mapboxgl-popup-content {
  background: var(--bg-base) !important;
  border: none !important;
  border-radius: var(--radius) !important;
  padding: 0 !important;
  box-shadow: var(--shadow) !important;
}

.cluster-popup-container.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
  border-top-color: var(--bg-base) !important;
}

.cluster-popup {
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--text-sm);
  font-weight: 500;
  color: var(--text-secondary);
  white-space: nowrap;
}

