/* ExploreMap Styles
 * Map container and bottom card (Airbnb-style).
 */

.explore-map {
  position: relative;
  width: 100%;
  height: 100%;
}

.explore-map__container {
  width: 100%;
  height: 100%;
  /* Transparent to show starfield behind */
  background: transparent;
  /* Glass-style border following design system */
  border: 1px solid var(--glass-border);
  border-radius: calc(var(--radius) * 2);
  overflow: hidden;
  /* Start invisible, fade in when loaded */
  opacity: 0;
  transition: opacity 0.4s ease-out;
}

/* Make Mapbox canvas transparent so starfield shows through */
.explore-map__container .mapboxgl-canvas {
  background: transparent !important;
}

/* Hide geolocate button (we auto-trigger it, only show the user marker) */
.explore-map__container .mapboxgl-ctrl-geolocate {
  display: none;
}

.explore-map__container--loaded {
  opacity: 1;
}

/* Remove border and radius on mobile */
@media (max-width: 768px) {
  .explore-map__container {
    border: none;
    border-radius: 0;
  }
}

/* Error State */
.explore-map--error {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-md);
  color: var(--text-muted);
}

.explore-map--error i {
  font-size: 48px;
  color: var(--error);
  opacity: 0.7;
}

/* ========================================
   Bottom Card (matches LocationCard styling)
   ======================================== */

/* Card dimension variables - used by JS for flyTo offset calculation */
.explore-map {
  --card-margin: var(--space-md);
  --card-aspect-ratio: calc(7 / 16);
  --card-content-height: 80px;
}

.map-card {
  position: absolute;
  bottom: var(--card-margin);
  left: var(--card-margin);
  right: var(--card-margin);
  background: var(--bg-base);
  border-radius: calc(var(--radius) * 2);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.25);
  overflow: hidden;
  cursor: pointer;
  z-index: 5; /* Below map controls (10) */

  /* Slide-up animation */
  transform: translateY(calc(100% + var(--space-md)));
  opacity: 0;
  transition: transform 0.3s ease-out, opacity 0.3s ease-out;
}

.map-card--visible {
  transform: translateY(0);
  opacity: 1;
}

/* Fade animation for switching between markers */
.map-card--switching {
  transition: opacity 0.15s ease-out;
  transform: translateY(0);
}

/* Card Loading State */
.map-card__loading {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-xl);
  color: var(--accent);
  font-size: var(--text-xl);
}

/* Card Image Container - uses grid for navigation mode collapse animation */
.map-card__image-container {
  position: relative;
  width: 100%;
  display: grid;
  grid-template-rows: 1fr;
  transition: grid-template-rows 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Inner wrapper required for grid collapse animation */
.map-card__image-inner {
  position: relative;
  width: 100%;
  min-height: 0; /* Required for grid animation - allows shrinking to 0 */
  overflow: hidden;
}

.map-card__image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Card Button - shared base styles for all card buttons */
.map-card__btn {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  background: var(--navbar-bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-full);
  color: var(--text-secondary);
  font-size: var(--text-base);
  cursor: pointer;
  text-decoration: none;
  transition: opacity 0.3s ease, color 0.15s ease, border-color 0.15s ease;
}

.map-card__btn:hover {
  color: var(--text-primary);
  border-color: var(--text-muted);
}

/* Close button - top right */
.map-card__btn--close {
  position: absolute;
  top: var(--space-sm);
  right: var(--space-sm);
  z-index: 3;
}

/* Favorite button - top right, next to close */
.map-card__btn--favorite {
  position: absolute;
  top: var(--space-sm);
  right: calc(var(--space-sm) + 40px + var(--space-xs));
  z-index: 3;
}

.map-card__btn--favorite.active {
  color: var(--favorite);
  border-color: var(--favorite);
}

.map-card__btn--favorite.active:hover {
  color: var(--favorite-hover);
  border-color: var(--favorite-hover);
}

/* Observatory action buttons container - top left */
.map-card__actions {
  position: absolute;
  top: var(--space-sm);
  left: var(--space-sm);
  display: flex;
  gap: var(--space-xs);
  z-index: 3;
  transition: opacity 0.3s ease;
}

/* ========================================
   Navigation Mode Transformation
   ======================================== */

/* Collapse image container in navigation mode */
.map-card--navigation .map-card__image-container {
  grid-template-rows: 0fr;
}

/* Fade out all buttons in navigation mode */
.map-card--navigation .map-card__btn,
.map-card--navigation .map-card__actions {
  opacity: 0;
  pointer-events: none;
}

/* Disable card click behavior in navigation mode */
.map-card--navigation {
  cursor: default;
}

/* Header row - flex container for header info and route stats */
.map-card__header-row {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: var(--space-md);
}

/* In navigation mode, ensure header doesn't grow to push route stats */
.map-card__header-row--navigation .map-card__header {
  min-width: 0; /* Allow text truncation */
}

/* Route stats - inline display in navigation mode */
.map-card__route-stats {
  display: flex;
  align-items: center;
  gap: var(--space-md);
  flex-shrink: 0; /* Don't shrink route stats */
  line-height: 1.3; /* Match location name line-height */
  opacity: 0;
  animation: route-stats-appear 0.3s ease 0.35s forwards;
}

.map-card__route-stats > i {
  font-size: var(--text-xs);
  color: var(--info);
}

.map-card__route-stats > span {
  font-size: var(--text-xs);
  color: var(--text-secondary);
}

/* Hint state - muted colors when location unavailable */
.map-card__route-stats--hint > i {
  color: var(--text-muted);
}

.map-card__route-stats--hint > span {
  color: var(--text-muted);
}

/* ========================================
   Navigation Mode - Content Transformation
   ======================================== */

/* Metadata container - uses grid for smooth collapse */
.map-card__meta-container {
  display: grid;
  grid-template-rows: 1fr;
  transition: grid-template-rows 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.map-card__meta-container--hidden {
  grid-template-rows: 0fr;
}

.map-card__meta {
  min-height: 0;
  overflow: hidden;
}

.map-card__meta-container--hidden .map-card__meta {
  opacity: 0;
  transition: opacity 0.15s ease;
}

/* Route info section - appears in navigation mode after card morphs */
.map-card__route {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: var(--space-md);
  opacity: 0;
  transform: translateY(8px);
  animation: route-info-appear 0.3s cubic-bezier(0.4, 0, 0.2, 1) 0.35s forwards;
}

@keyframes route-info-appear {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.map-card__route-from {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

/* Right side - action buttons */
.map-card__route-actions {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  flex-shrink: 0;
}

/* Small button variant for route actions */
.btn-secondary--sm {
  padding: var(--space-sm) var(--space-md);
  font-size: var(--text-sm);
}

.map-card__route-label {
  font-size: var(--text-xs);
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.map-card__route-value {
  font-size: var(--text-sm);
  color: var(--text-secondary);
}

.map-card__route-value--warning {
  color: var(--warning);
}

/* Route stats row - matches .map-card__meta styling */
.map-card__route-stats {
  display: flex;
  align-items: center;
  gap: var(--space-md);
  flex-wrap: wrap;
  min-height: 0;
  overflow: hidden;
}

/* Loading/error state text */
.map-card__route-stats > i {
  font-size: var(--text-xs);
  width: 12px;
  text-align: center;
  color: var(--accent);
}

.map-card__route-stats > span {
  font-size: var(--text-xs);
  color: var(--text-secondary);
}

.map-card__route-stats--error {
  color: var(--text-muted);
}

.map-card__route-stats--error > i {
  color: var(--text-muted);
}

.map-card__route-stats--error > span {
  color: var(--text-muted);
}

/* Duration and distance items - match .map-card__meta > div */
.map-card__route-duration,
.map-card__route-distance {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: var(--text-xs);
  color: var(--text-secondary);
  line-height: 1;
}

/* Duration is bolder to emphasize time */
.map-card__route-duration {
  font-weight: var(--font-semibold);
}

.map-card__route-duration i,
.map-card__route-distance i {
  font-size: var(--text-xs);
  width: 12px;
  text-align: center;
}

.map-card__route-duration i,
.map-card__route-distance i {
  color: var(--info);
}

.map-card__route-estimated {
  color: var(--text-muted);
  font-size: var(--text-xs);
  margin-left: 2px;
}

.map-card__route-unavailable {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: var(--text-xs);
  color: var(--warning);
}

.map-card__route-unavailable i {
  font-size: var(--text-xs);
  width: 12px;
  text-align: center;
}

@keyframes route-stats-appear {
  to {
    opacity: 1;
  }
}

/* Mobile: Stack route stats vertically */
@media (max-width: 480px) {
  .map-card__route-stats {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-xs);
  }
}

/* Card Content - matches LocationCard */
.map-card__content {
  padding: var(--space-md);
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  min-width: 0; /* Allow text truncation */
  overflow: hidden;
}

.map-card__header {
  display: flex;
  flex-direction: column;
  gap: 2px;
  min-width: 0; /* Allow text truncation in flex container */
}

.map-card__name {
  font-family: var(--font-display);
  font-size: var(--text-base);
  font-weight: 600;
  color: var(--text-primary);
  margin: 0;
  line-height: 1.3;
  /* Truncate long names */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.map-card__region {
  font-size: var(--text-sm);
  color: var(--text-muted);
  /* Truncate long location strings */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Card Meta - matches LocationCard */
.map-card__meta {
  display: flex;
  align-items: center;
  gap: var(--space-md);
  flex-wrap: wrap;
  min-height: 0; /* Required for grid collapse animation */
  overflow: hidden;
  transition: opacity 0.15s ease;
}

.map-card__meta > div {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: var(--text-xs);
  color: var(--text-secondary);
  line-height: 1;
}

.map-card__meta i {
  font-size: var(--text-xs);
  width: 12px;
  text-align: center;
}

.map-card__meta span {
  font-size: var(--text-xs);
}

/* Rating */
.map-card__rating i {
  color: var(--star-filled);
}

.map-card__reviews {
  color: var(--text-muted);
}

.map-card__rating--empty {
  color: var(--text-muted);
}

.map-card__rating--empty i {
  color: var(--text-muted);
}

/* Elevation */
.map-card__elevation i {
  color: var(--elevation);
}

/* Distance */
.map-card__distance i {
  color: var(--info);
}

/* ========================================
   Map Controls (Zones, Style Picker)
   ======================================== */

.explore-map__controls {
  position: absolute;
  top: var(--space-md);
  right: var(--space-md);
  display: flex;
  flex-direction: column;
  gap: var(--space-sm);
  z-index: 10;
}

/* Left-side controls (navigation button) */
.explore-map__controls--left {
  right: auto;
  left: var(--space-md);
}

.explore-map__control {
  position: relative;
  /* Start hidden, animate in when map loads */
  opacity: 0;
  transform: translateX(10px);
}

/* Staggered fade-in animation for each control */
.explore-map__controls--loaded .explore-map__control {
  animation: controlFadeIn 0.3s ease-out forwards;
  /* Default delay, overridden by inline style */
  animation-delay: var(--stagger-delay, 0.3s);
}

/* Left controls animate from left */
.explore-map__controls--left .explore-map__control {
  transform: translateX(-10px);
  /* Don't establish positioning context - let dropdown position relative to map container */
  position: static;
}

.explore-map__controls--left.explore-map__controls--loaded .explore-map__control {
  animation: controlFadeInLeft 0.3s ease-out forwards;
  animation-delay: var(--stagger-delay, 0.3s);
}

@keyframes controlFadeIn {
  from {
    opacity: 0;
    transform: translateX(10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes controlFadeInLeft {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Circular icon-only buttons using navbar color */
.explore-map__control-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  padding: 0;
  background: var(--navbar-bg);
  border: 1px solid var(--border);
  border-radius: var(--radius-full);
  color: var(--text-secondary);
  font-size: var(--text-base);
  cursor: pointer;
  transition: all var(--transition) ease;
}

.explore-map__control-btn:hover {
  color: var(--text-primary);
  border-color: var(--text-muted);
}

.explore-map__control-btn--active {
  color: var(--accent);
  border-color: var(--accent);
}

.explore-map__control-btn--active:hover {
  color: var(--accent-hover);
  border-color: var(--accent-hover);
}

/* Bortle info button - positioned next to Mapbox attribution button */
.explore-map__bortle-info {
  position: absolute;
  bottom: 10px;
  right: 42px;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  background: #fff;
  border-radius: 50%;
  color: #000;
  font-size: 15px;
  cursor: pointer;
  text-decoration: none;
  z-index: 1;
}

@keyframes bortleInfoFadeIn {
  from {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

/* Dropdown positioned to the left of buttons */
.explore-map__dropdown {
  --dropdown-animation-duration: 0.1s;

  position: absolute;
  top: 0;
  right: calc(100% + var(--space-sm));
  min-width: 200px;
  padding: var(--space-sm);
  background: var(--bg-base);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  /* Fade animation */
  animation: dropdownFadeIn var(--dropdown-animation-duration) ease-out forwards;
}

/* Dropdown positioned to the right of buttons (for left-side controls) */
.explore-map__dropdown--right {
  right: auto;
  left: calc(100% + var(--space-sm));
}

@keyframes dropdownFadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.explore-map__dropdown--closing {
  animation: dropdownFadeOut var(--dropdown-animation-duration) ease-out forwards;
}

@keyframes dropdownFadeOut {
  from { opacity: 1; }
  to { opacity: 0; }
}

.explore-map__dropdown-option {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  padding: var(--space-xs) var(--space-sm);
  border-radius: calc(var(--radius) / 2);
  cursor: pointer;
  transition: background var(--transition) ease;
  background: transparent;
  border: none;
  width: 100%;
  text-align: left;
  color: var(--text-primary);
}

.explore-map__dropdown-option:hover {
  background: var(--accent-bg);
}

/* Custom checkbox styling matching form-checkbox */
.explore-map__dropdown-option input[type="checkbox"] {
  appearance: none;
  -webkit-appearance: none;
  width: 16px;
  height: 16px;
  background: var(--glass-bg-hover);
  border: 1px solid var(--glass-border-hover);
  border-radius: 4px;
  cursor: pointer;
  position: relative;
  transition: background-color 0.2s ease, border-color 0.2s ease;
  flex-shrink: 0;
}

.explore-map__dropdown-option input[type="checkbox"]:hover {
  border-color: var(--accent);
}

.explore-map__dropdown-option input[type="checkbox"]:checked {
  background: var(--accent);
  border-color: var(--accent);
}

.explore-map__dropdown-option input[type="checkbox"]:checked::after {
  content: '';
  position: absolute;
  top: 2px;
  left: 5px;
  width: 4px;
  height: 8px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

/* Custom radio button styling matching checkbox */
.explore-map__dropdown-option input[type="radio"] {
  appearance: none;
  -webkit-appearance: none;
  width: 16px;
  height: 16px;
  background: var(--glass-bg-hover);
  border: 1px solid var(--glass-border-hover);
  border-radius: var(--radius-full);
  cursor: pointer;
  position: relative;
  transition: background-color 0.2s ease, border-color 0.2s ease;
  flex-shrink: 0;
}

.explore-map__dropdown-option input[type="radio"]:hover {
  border-color: var(--accent);
}

.explore-map__dropdown-option input[type="radio"]:checked {
  background: var(--accent);
  border-color: var(--accent);
}

.explore-map__dropdown-option input[type="radio"]:checked::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 6px;
  height: 6px;
  background: white;
  border-radius: var(--radius-full);
  transform: translate(-50%, -50%);
}

/* IUCN color swatch */
.explore-map__iucn-color {
  width: 12px;
  height: 12px;
  border-radius: 2px;
  flex-shrink: 0;
}

.explore-map__dropdown-label {
  font-size: var(--text-sm);
  color: var(--text-primary);
  white-space: nowrap;
}

.explore-map__dropdown-hint {
  font-size: var(--text-xs);
  color: var(--text-muted);
  padding: var(--space-xs) var(--space-sm);
  border-bottom: 1px solid var(--border-subtle);
  margin-bottom: var(--space-xs);
}

/* "All" toggle option with separator */
.explore-map__dropdown-option--all {
  border-bottom: 1px solid var(--border-subtle);
  margin-bottom: var(--space-xs);
  padding-bottom: var(--space-sm);
}

.explore-map__dropdown-option--all .explore-map__dropdown-label {
  font-weight: 500;
}


/* ========================================
   Protected Area Popup
   ======================================== */

/* Mapbox popup container override - use !important to override Mapbox defaults immediately */
.protected-area-popup-container.mapboxgl-popup .mapboxgl-popup-content {
  background: var(--bg-base) !important;
  border: none !important;
  border-radius: var(--radius) !important;
  padding: 0 !important;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4) !important;
}

/* Style the popup tip (arrow) to match background - anchor-specific to preserve triangle shape */
.protected-area-popup-container.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
  border-top-color: var(--bg-base) !important;
}

.protected-area-popup-container.mapboxgl-popup-anchor-top .mapboxgl-popup-tip {
  border-bottom-color: var(--bg-base) !important;
}

.protected-area-popup-container.mapboxgl-popup-anchor-left .mapboxgl-popup-tip {
  border-right-color: var(--bg-base) !important;
}

.protected-area-popup-container.mapboxgl-popup-anchor-right .mapboxgl-popup-tip {
  border-left-color: var(--bg-base) !important;
}

/* Corner anchors: square off the corner where tip connects */
.protected-area-popup-container.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip {
  border-bottom-color: var(--bg-base) !important;
}
.protected-area-popup-container.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content {
  border-top-left-radius: 0 !important;
}

.protected-area-popup-container.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip {
  border-bottom-color: var(--bg-base) !important;
}
.protected-area-popup-container.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content {
  border-top-right-radius: 0 !important;
}

.protected-area-popup-container.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip {
  border-top-color: var(--bg-base) !important;
}
.protected-area-popup-container.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content {
  border-bottom-left-radius: 0 !important;
}

.protected-area-popup-container.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {
  border-top-color: var(--bg-base) !important;
}
.protected-area-popup-container.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content {
  border-bottom-right-radius: 0 !important;
}

/* Popup inner content */
.protected-area-popup {
  padding: var(--space-sm) var(--space-md);
  min-width: 200px;
  max-width: 280px;
}

.protected-area-popup__header {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
  margin-bottom: var(--space-xs);
}

.protected-area-popup__color {
  width: 10px;
  height: 10px;
  border-radius: 2px;
  flex-shrink: 0;
}

.protected-area-popup__name {
  font-family: var(--font-display);
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--text-primary);
  line-height: 1.3;
}

.protected-area-popup__designation {
  font-size: var(--text-xs);
  color: var(--text-muted);
  margin-bottom: var(--space-sm);
  padding-left: calc(10px + var(--space-sm)); /* Align with name */
}

.protected-area-popup__details {
  display: flex;
  flex-direction: column;
  gap: var(--space-xs);
  border-top: 1px solid var(--border-subtle);
  padding-top: var(--space-sm);
}

.protected-area-popup__row {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: var(--space-md);
}

.protected-area-popup__label {
  font-size: var(--text-xs);
  color: var(--text-muted);
  white-space: nowrap;
}

.protected-area-popup__value {
  font-size: var(--text-xs);
  color: var(--text-secondary);
  text-align: right;
}

/* ========================================
   Location Marker Popup
   ======================================== */

/* Mapbox popup container override */
.marker-popup-container.mapboxgl-popup .mapboxgl-popup-content {
  background: var(--bg-base) !important;
  border: none !important;
  border-radius: var(--radius) !important;
  padding: 0 !important;
  box-shadow: var(--shadow) !important;
}

/* Style the popup tip - anchor-specific */
.marker-popup-container.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
  border-top-color: var(--bg-base) !important;
}

.marker-popup-container.mapboxgl-popup-anchor-top .mapboxgl-popup-tip {
  border-bottom-color: var(--bg-base) !important;
}

.marker-popup-container.mapboxgl-popup-anchor-left .mapboxgl-popup-tip {
  border-right-color: var(--bg-base) !important;
}

.marker-popup-container.mapboxgl-popup-anchor-right .mapboxgl-popup-tip {
  border-left-color: var(--bg-base) !important;
}

/* Hide tip for corner anchors */
.marker-popup-container.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip,
.marker-popup-container.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip,
.marker-popup-container.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip,
.marker-popup-container.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip {
  display: none !important;
}

/* Popup inner content */
.marker-popup {
  padding: var(--space-sm) var(--space-md);
  min-width: 140px;
}

.marker-popup__type {
  font-size: var(--text-xs);
  font-weight: 500;
  color: var(--accent);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 2px;
}

.marker-popup__name {
  font-family: var(--font-display);
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--text-primary);
  line-height: 1.3;
  margin-bottom: 2px;
}

.marker-popup__region {
  font-size: var(--text-xs);
  color: var(--text-muted);
  margin-bottom: var(--space-xs);
}

.marker-popup__meta {
  display: flex;
  align-items: center;
  gap: var(--space-sm);
}

.marker-popup__rating {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: var(--text-xs);
  color: var(--text-secondary);
}

.marker-popup__rating i {
  color: var(--star-filled);
  font-size: var(--text-xs);
}

.marker-popup__rating--empty {
  color: var(--text-muted);
}

.marker-popup__reviews {
  color: var(--text-muted);
}

.marker-popup__no-rating {
  font-style: italic;
  color: var(--text-muted);
}

.marker-popup__favorite {
  color: var(--favorite);
  font-size: var(--text-xs);
}


/* ========================================
   Cluster Popup
   ======================================== */

.cluster-popup-container.mapboxgl-popup .mapboxgl-popup-content {
  background: var(--bg-base) !important;
  border: none !important;
  border-radius: var(--radius) !important;
  padding: 0 !important;
  box-shadow: var(--shadow) !important;
}

.cluster-popup-container.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip {
  border-top-color: var(--bg-base) !important;
}

.cluster-popup {
  padding: var(--space-xs) var(--space-sm);
  font-size: var(--text-sm);
  font-weight: 500;
  color: var(--text-secondary);
  white-space: nowrap;
}


/* ========================================
   Popup Variant (Desktop/Tablet â‰¥768px)
   Positioned centered on map marker via ref.
   ======================================== */

.map-card--popup {
  /* Override bottom positioning */
  bottom: auto;
  left: auto;
  right: auto;
  width: 320px;

  /* Center on marker point */
  transform: translate(-50%, -50%);

  /* No slide animation - use fade */
  opacity: 1;

  /* Fade-in animation */
  animation: mapCardPopupFadeIn 0.2s ease-out;
}

@keyframes mapCardPopupFadeIn {
  from {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}

/* Popup close animation */
.map-card--popup.map-card--closing {
  animation: mapCardPopupFadeOut 0.2s ease-out forwards;
}

@keyframes mapCardPopupFadeOut {
  from {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  to {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.95);
  }
}

/* Tablet: Slightly smaller popup */
@media (min-width: 768px) and (max-width: 1023px) {
  .map-card--popup {
    width: 280px;
  }
}

/* Popup uses smaller buttons */
.map-card--popup .map-card__btn {
  width: 36px;
  height: 36px;
  font-size: var(--text-sm);
}

/* Adjust favorite position for smaller buttons */
.map-card--popup .map-card__btn--favorite {
  right: calc(var(--space-sm) + 36px + var(--space-xs));
}

